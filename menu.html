<!DOCTYPE html>
<html>
<head>
<style>

#icon {
  margin: 0px;
  padding: 0px;
  position: absolute;
  right: 10px;
  top: 10px;
}


table {
    border-collapse: collapse;
    width: 100%;
    font-family: Arial, Helvetica, sans-serif;
}

th {
    text-align: left;
    padding: 8px;
}

tr:nth-child(even){background-color: #cce6ff}
tr:hover {background-color: #80c1ff}

th {
    background-color: #3399ff;
    color: white;
}

td a {display: block;
  text-decoration: none;
  color: black;
  text-align: left;
  padding: 8px;
}


</style>
</head>
<body>

<div id="icon">
	<p id="username"></p>
</div>

<h1 style="margin:0">Space Engineers <span style="color:chartreuse">●</span></h1>
Lista server<br />

<div style="float: right;"><a href="#">Modifica</a></div>
<br />


<details>
	<summary>Info</summary>
	<p>
		<b>Info globali</b><br />
		Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.<br />
		<br />
		<b>oreinfo</b><br />
		Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
	</p>
</details>

<br />

<form action="#" method="post" id="form_id">

  <input id="name_form" type="text" name="name" placeholder="nome">

  <input id="ipaddress_form" type="text" name="ipaddress" placeholder="indirizzo IP">

  <input id="port_form" type="text" name="port" placeholder="porta">

  <select id="gioco_form" name="game">
    <option value="0">Space Engineers</option>
    <option value="1">CSGO</option>
    <option value="2">The Ship</option>
  </select>

  <input id="description_form" type="text" name="description" placeholder="descrizione">

  <input type="button" id="btn_id" value="Aggiungi" onclick="submit_by_id()"/>

</form>


<br />



<form action="script.php" method="post">

<span style="float: left">Last check 3min ago, next in 7min.</span>
<span style="float: right"><input type="button" value="Elimina" id="delButton" /></span>

<table id="serversTable">
</table>

</form>

<a id="text_element" href="#" onclick="copyToClipboard('text_element')">Cleveland</a>
<br/><br/><input type="text" placeholder="Paste here for checking" />

<br />
















</body>


<SCRIPT>



document.addEventListener("DOMContentLoaded", function(){
	robbeh();
	var myVar = setInterval(robbeh, 5000);
});




function robbeh(){

//Thx to http://youmightnotneedjquery.com/
var request = new XMLHttpRequest();
request.open('GET', 'test.php?what=serverList', true);

request.onload = function() {
  if (request.status >= 200 && request.status < 400) {
    // Success!
    var data = JSON.parse(request.responseText);




var username = document.getElementById('username');

username.innerHTML = data["user"]["name"] + "<br />Disconnnetti"

var tobj = data["team"][0]["servers"];


var globalCounter = 0;


var table = document.getElementById('serversTable');


var thead = "<thead><tr><th></th><th>Nome</th><th>Giocatori</th><th>Ping</th><th>IP:porta</th></tr></thead>";


var tbody = "<tbody>";

for (var i = 0; i < Object.keys(tobj).length; i++) {
    var tr = "<tr>";

    tr += '<td><input type="checkbox" value="' + tobj[i].id + '" /></td><td><a href="#" onclick="copyToClipboard(\'r'+i+'\')">' + tobj[i].name + '</a></td>' + '<td><a href="#" onclick="copyToClipboard(\'r'+i+'\')">' + tobj[i].players.toString() + '/' + tobj[i].maxPlayers.toString() + '</a></td><td><a href="#" onclick="copyToClipboard(\'r'+i+'\')">' + tobj[i].ping.toString() + 'ms</a></td><td><a id="r'+i+'" href="#" onclick="copyToClipboard(\'r'+i+'\')">' + tobj[i].address.toString() + '</a></td></tr>';
    tbody += tr;
}

tbody += "</tbody>";
table.innerHTML = thead + tbody;





  } else {
    // We reached our target server, but it returned an error

  }
};

request.onerror = function() {
  // There was a connection error of some sort
};

request.send();


};



















// Submit form with id function.
function submit_by_id() {


var data = {'name': document.getElementById("name_form").value, 'ipaddress': document.getElementById("ipaddress_form").value, 'port': document.getElementById("port_form").value, 'game': document.getElementById("gioco_form").value, 'description': document.getElementById("description_form").value}
var params = encodeQueryData(data);


var http = new XMLHttpRequest();
var url = "test.php";

http.open("POST", url, true);

//Send the proper header information along with the request
http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

http.onreadystatechange = function() {//Call a function when the state changes.
    if(http.readyState == 4 && http.status == 200) {
        alert(http.responseText);
    }
}
http.send(params);





function encodeQueryData(data) {
   let ret = [];
   for (let d in data)
     ret.push(encodeURIComponent(d) + '=' + encodeURIComponent(data[d]));
   return ret.join('&');
}





//if (validation()) // Calling validation function
//{
//document.getElementById("form_id").submit(); //form submission
//alert(" Name : " + name + " \n Email : " + email + " \n Form Id : " + document.getElementById("form_id").getAttribute("id") + "\n\n Form Submitted Successfully......");
}
//}





// Name and Email validation Function.
function validation() {
var name = document.getElementById("name").value;
var email = document.getElementById("email").value;
var emailReg = /^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;
if (name === '' || email === '') {
alert("Please fill all fields...!!!!!!");
return false;
} else if (!(email).match(emailReg)) {
alert("Invalid Email...!!!!!!");
return false;
} else {
return true;
}
}




















//Thx internet! <3
function copyToClipboard(elementId) {

  // Create an auxiliary hidden input
  var aux = document.createElement("input");

  // Get the text from the element passed into the input
  aux.setAttribute("value", document.getElementById(elementId).innerHTML);

  // Append the aux input to the body
  document.body.appendChild(aux);

  // Highlight the content
  aux.select();

  // Execute the copy command
  document.execCommand("copy");

  // Remove the input from the body
  document.body.removeChild(aux);


}

function log(){
	console.log('---')
}




// Ritorna un array con i valori dei checkbox selezionati
function getSelectedChbox(elementi) {
  var array = [];        // Array che conterrà i valori dei checkbox selezionati

  // ottiene tutti i tag "input" ed il loro numero
  var inpfields = elementi.getElementsByTagName('input');
  var nr_inpfields = inpfields.length;

  for(var i=0; i<nr_inpfields; i++) {
    //solo i tag "input" che sono checkbox e sono selezionati
    if(inpfields[i].type == 'checkbox' && inpfields[i].checked == true){
	array.push(inpfields[i].value);
    }
  }

  return {"operation":"delete", "items":array};
}


// Quando si clicca sul pulsante con tag #delButton, viene lanciato un alert con i valori selezionati nelle checkbox
document.getElementById('delButton').onclick = function(){
  var selchb = getSelectedChbox(this.form);
  alert(JSON.stringify(selchb));
}


</SCRIPT>

</html>
